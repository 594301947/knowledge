# 知识点

* TCP数据报：

  ![TCP数据报](G:\knowledge\网络\images\TCP数据报.jpg)

  > 1. 16位源端口
  > 2. 16位目的端口
  > 3. 32位序号（seq）
  > 4. 32位确认序号（ack）
  > 5. 4位首部长度
  > 6. 6个标记位：
  >    1. SYN：数据请求标记
  >    2. ACK：确认标记
  >    3. FIN：关闭请求标记
  >    4. URG
  >    5. PSH
  >    6. RST
  > 7. 16位窗口大小：65535

  

* **一对客户端/服务器socket通信有3个套接字：**

1. 客户端一个：用于跟服务器通信
2. 服务器一个：用于跟客户端通信
3. 服务器还有一个：用于监听连接

* listen()函数：设置监听同时连接上限

# SOCKET通信模型

![通信模型](G:\knowledge\网络\images\SOCKET模型创建.png)

> server:
>
> 1. socket()：创建socket
> 2. bind()：绑定服务器地址结构
> 3. listen()：设置监听上限
> 4. accpet()：阻塞监听客户端连接
> 5. read()：读取客户端数据
> 6. write()：发送数据给客户端
> 7. close()：关闭连接

> client：
>
> 1. socket()：创建socket
> 2. connect()：与服务器建立连接
> 3. read()：读取客户端数据
> 4. write()：发送数据给客户端
> 5. close()：关闭连接

# 通信时序

## 建立连接3次握手

三次握手时序图：  

![3次握手](G:\knowledge\网络\images\TCP三次握手.jpg)

过程：

1. 客户端向服务端发送连接请求报文（客户端进入**SYN-SEND**状态）。SYN标志位为1，seq序号为**n**。
2. 服务端收到客户端请求（服务端结束**LISTEN**状态）。发送应答报文（服务端进入**SYN-RCVD**状态）。SYN标记位为1，seq序号为**k**。ACK标记位为1，ack确认序号为**n+1**
3. 客户端收到应答报文，再发送一个应答报文给服务端。（客户端和服务端状态进入ESTABLISHEN）。ACK标记位为1，ack确认序号为**k+1**，seq序号为n+1。

